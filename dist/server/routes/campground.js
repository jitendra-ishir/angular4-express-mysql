"use strict";
/**
 * Created by laurence-ho on 21/07/17.
 */
var express = require("express");
var router = express.Router();
var db = require('../database/db.service');
var authentication = require('../authentication');
// get all campgrounds
router.get('/campground', function (req, res) {
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('SELECT * FROM campgrounds', function (err, results) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.send(results);
                }
            });
        }
    });
});
// create one campground
router.post('/campground', authentication.isLoggedIn, function (req, res) {
    req.body.name = req.sanitize(req.body.name);
    req.body.image = req.sanitize(req.body.image);
    req.body.description = req.sanitize(req.body.description);
    req.body.price = req.sanitize(req.body.price);
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('INSERT INTO campgrounds SET ?', req.body, function (err, result) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.status(200).send({ campground_id: result.insertId });
                }
            });
        }
    });
});
// get one campground with comments
router.get('/campground/:id', function (req, res) {
    var campground = [], comments = [];
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('SELECT * FROM campgrounds WHERE id = ?', [req.params.id], function (err, result) {
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    campground = result[0];
                }
            });
            connection.query('SELECT * FROM comments WHERE campground_id = ?', [req.params.id], function (err, result) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    comments = result;
                    res.status(200).send({ campground: campground, comments: comments });
                }
            });
        }
    });
});
// get campground without comment for edit
router.get('/campground/:id/edit', authentication.checkCampOwner, function (req, res) {
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('SELECT * FROM campgrounds WHERE id = ?', [req.params.id], function (err, result) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.status(200).send({ campground: result[0] });
                }
            });
        }
    });
});
// edit one campground
router.put('/campground/:id/edit', authentication.checkCampOwner, function (req, res) {
    req.body.name = req.sanitize(req.body.name);
    req.body.image = req.sanitize(req.body.image);
    req.body.description = req.sanitize(req.body.description);
    req.body.price = req.sanitize(req.body.price);
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('UPDATE campgrounds SET ? WHERE id = ?', [req.body, req.params.id], function (err) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.status(200).send({ campground_id: req.params.id });
                }
            });
        }
    });
});
// delete one campground
router.delete('/campground/:id', authentication.checkCampOwner, function (req, res) {
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            connection.query('DELETE FROM campgrounds WHERE id = ?', [req.params.id], function (err) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.status(200).send({ campground_id: req.params.id });
                }
            });
        }
    });
});
module.exports = router;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsVUFBQyxHQUFRO2dCQUNsRixVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBRXJCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ1QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztnQkFDdEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDUCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUM7Z0JBQ3RELENBQUM7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUM7SUFDRixDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUgsaUJBQVMsTUFBTSxDQUFDIiwiZmlsZSI6InJvdXRlcy9jYW1wZ3JvdW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgbGF1cmVuY2UtaG8gb24gMjEvMDcvMTcuXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuXHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcblxyXG5jb25zdCBkYiA9IHJlcXVpcmUoJy4uL2RhdGFiYXNlL2RiLnNlcnZpY2UnKTtcclxuY29uc3QgYXV0aGVudGljYXRpb24gPSByZXF1aXJlKCcuLi9hdXRoZW50aWNhdGlvbicpO1xyXG5cclxuLy8gZ2V0IGFsbCBjYW1wZ3JvdW5kc1xyXG5yb3V0ZXIuZ2V0KCcvY2FtcGdyb3VuZCcsIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcclxuXHRkYi5nZXRDb25uZWN0aW9uKChlcnI6IGFueSwgY29ubmVjdGlvbjogYW55KSA9PiB7XHJcblx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlcnJ9KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvbm5lY3Rpb24ucXVlcnkoJ1NFTEVDVCAqIEZST00gY2FtcGdyb3VuZHMnLCAoZXJyOiBhbnksIHJlc3VsdHM6IGFueSkgPT4ge1xyXG5cdFx0XHRcdGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xyXG5cclxuXHRcdFx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZXJyfSk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJlcy5zZW5kKHJlc3VsdHMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pO1xyXG5cclxuLy8gY3JlYXRlIG9uZSBjYW1wZ3JvdW5kXHJcbnJvdXRlci5wb3N0KCcvY2FtcGdyb3VuZCcsIGF1dGhlbnRpY2F0aW9uLmlzTG9nZ2VkSW4sIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcclxuXHRyZXEuYm9keS5uYW1lID0gcmVxLnNhbml0aXplKHJlcS5ib2R5Lm5hbWUpO1xyXG5cdHJlcS5ib2R5LmltYWdlID0gcmVxLnNhbml0aXplKHJlcS5ib2R5LmltYWdlKTtcclxuXHRyZXEuYm9keS5kZXNjcmlwdGlvbiA9IHJlcS5zYW5pdGl6ZShyZXEuYm9keS5kZXNjcmlwdGlvbik7XHJcblx0cmVxLmJvZHkucHJpY2UgPSByZXEuc2FuaXRpemUocmVxLmJvZHkucHJpY2UpO1xyXG5cclxuXHRkYi5nZXRDb25uZWN0aW9uKChlcnI6IGFueSwgY29ubmVjdGlvbjogYW55KSA9PiB7XHJcblx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlcnJ9KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvbm5lY3Rpb24ucXVlcnkoJ0lOU0VSVCBJTlRPIGNhbXBncm91bmRzIFNFVCA/JywgcmVxLmJvZHksIChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcclxuXHRcdFx0XHRjb25uZWN0aW9uLnJlbGVhc2UoKTtcclxuXHJcblx0XHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDIwMCkuc2VuZCh7Y2FtcGdyb3VuZF9pZDogcmVzdWx0Lmluc2VydElkfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG4vLyBnZXQgb25lIGNhbXBncm91bmQgd2l0aCBjb21tZW50c1xyXG5yb3V0ZXIuZ2V0KCcvY2FtcGdyb3VuZC86aWQnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XHJcblx0bGV0IGNhbXBncm91bmQ6IGFueSA9IFtdLFxyXG5cdFx0Y29tbWVudHM6IGFueSA9IFtdO1xyXG5cclxuXHRkYi5nZXRDb25uZWN0aW9uKChlcnI6IGFueSwgY29ubmVjdGlvbjogYW55KSA9PiB7XHJcblx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlcnJ9KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvbm5lY3Rpb24ucXVlcnkoJ1NFTEVDVCAqIEZST00gY2FtcGdyb3VuZHMgV0hFUkUgaWQgPSA/JywgW3JlcS5wYXJhbXMuaWRdLCAoZXJyOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XHJcblx0XHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRjYW1wZ3JvdW5kID0gcmVzdWx0WzBdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRjb25uZWN0aW9uLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGNvbW1lbnRzIFdIRVJFIGNhbXBncm91bmRfaWQgPSA/JywgW3JlcS5wYXJhbXMuaWRdLCAoZXJyOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XHJcblx0XHRcdFx0Y29ubmVjdGlvbi5yZWxlYXNlKCk7XHJcblxyXG5cdFx0XHRcdGlmIChlcnIpIHtcclxuXHRcdFx0XHRcdHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlcnJ9KTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y29tbWVudHMgPSByZXN1bHQ7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDIwMCkuc2VuZCh7Y2FtcGdyb3VuZDogY2FtcGdyb3VuZCwgY29tbWVudHM6IGNvbW1lbnRzfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG4vLyBnZXQgY2FtcGdyb3VuZCB3aXRob3V0IGNvbW1lbnQgZm9yIGVkaXRcclxucm91dGVyLmdldCgnL2NhbXBncm91bmQvOmlkL2VkaXQnLCBhdXRoZW50aWNhdGlvbi5jaGVja0NhbXBPd25lciwgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xyXG5cdGRiLmdldENvbm5lY3Rpb24oKGVycjogYW55LCBjb25uZWN0aW9uOiBhbnkpID0+IHtcclxuXHRcdGlmIChlcnIpIHtcclxuXHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29ubmVjdGlvbi5xdWVyeSgnU0VMRUNUICogRlJPTSBjYW1wZ3JvdW5kcyBXSEVSRSBpZCA9ID8nLCBbcmVxLnBhcmFtcy5pZF0sIChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcclxuXHRcdFx0XHRjb25uZWN0aW9uLnJlbGVhc2UoKTtcclxuXHJcblx0XHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDIwMCkuc2VuZCh7Y2FtcGdyb3VuZDogcmVzdWx0WzBdfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG4vLyBlZGl0IG9uZSBjYW1wZ3JvdW5kXHJcbnJvdXRlci5wdXQoJy9jYW1wZ3JvdW5kLzppZC9lZGl0JywgYXV0aGVudGljYXRpb24uY2hlY2tDYW1wT3duZXIsIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcclxuXHRyZXEuYm9keS5uYW1lID0gcmVxLnNhbml0aXplKHJlcS5ib2R5Lm5hbWUpO1xyXG5cdHJlcS5ib2R5LmltYWdlID0gcmVxLnNhbml0aXplKHJlcS5ib2R5LmltYWdlKTtcclxuXHRyZXEuYm9keS5kZXNjcmlwdGlvbiA9IHJlcS5zYW5pdGl6ZShyZXEuYm9keS5kZXNjcmlwdGlvbik7XHJcblx0cmVxLmJvZHkucHJpY2UgPSByZXEuc2FuaXRpemUocmVxLmJvZHkucHJpY2UpO1xyXG5cclxuXHRkYi5nZXRDb25uZWN0aW9uKChlcnI6IGFueSwgY29ubmVjdGlvbjogYW55KSA9PiB7XHJcblx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlcnJ9KTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvbm5lY3Rpb24ucXVlcnkoJ1VQREFURSBjYW1wZ3JvdW5kcyBTRVQgPyBXSEVSRSBpZCA9ID8nLCBbcmVxLmJvZHksIHJlcS5wYXJhbXMuaWRdLCAoZXJyOiBhbnkpID0+IHtcclxuXHRcdFx0XHRjb25uZWN0aW9uLnJlbGVhc2UoKTtcclxuXHJcblx0XHRcdFx0aWYgKGVycikge1xyXG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDIwMCkuc2VuZCh7Y2FtcGdyb3VuZF9pZDogcmVxLnBhcmFtcy5pZH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pO1xyXG5cclxuLy8gZGVsZXRlIG9uZSBjYW1wZ3JvdW5kXHJcbnJvdXRlci5kZWxldGUoJy9jYW1wZ3JvdW5kLzppZCcsIGF1dGhlbnRpY2F0aW9uLmNoZWNrQ2FtcE93bmVyLCAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XHJcblx0ZGIuZ2V0Q29ubmVjdGlvbigoZXJyOiBhbnksIGNvbm5lY3Rpb246IGFueSkgPT4ge1xyXG5cdFx0aWYgKGVycikge1xyXG5cdFx0XHRyZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZXJyfSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRjb25uZWN0aW9uLnF1ZXJ5KCdERUxFVEUgRlJPTSBjYW1wZ3JvdW5kcyBXSEVSRSBpZCA9ID8nLCBbcmVxLnBhcmFtcy5pZF0sIChlcnI6IGFueSkgPT4ge1xyXG5cdFx0XHRcdGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xyXG5cclxuXHRcdFx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZXJyfSk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtjYW1wZ3JvdW5kX2lkOiByZXEucGFyYW1zLmlkfSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG5leHBvcnQgPSByb3V0ZXI7XHJcbiJdfQ==
